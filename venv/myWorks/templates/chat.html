<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var socket = io();
            var room = "{{ room_code }}";
            var username = "{{ username }}";
            var countdownInterval;

            socket.emit('join', {'username': username, 'room': room});

            document.getElementById('send').onclick = function() {
                var message = document.getElementById('message').value;
                socket.emit('message', {'username': username, 'message': message, 'room': room});
                document.getElementById('message').value = '';
            };

            socket.on('connect', function() {
                console.log('Connected with session ID:', socket.id);
            });

            socket.on('start_timer', function(data) {
                var countdownSeconds = data['countdown_seconds'];
                startCountdown(countdownSeconds);
            });

            socket.on('time_out', function() {
                alert('Time out!');
                window.location.href = '/';
            });

            socket.on('reveal_word', function(data) {
                var word = data['word'];
                document.getElementById('word').textContent = 'Word to guess: ' + word;
            });

            function startCountdown(totalSeconds) {
                var minutesDisplay, secondsDisplay;

                countdownInterval = setInterval(function() {
                    minutesDisplay = Math.floor(totalSeconds / 60);
                    secondsDisplay = totalSeconds % 60;

                    // Display the countdown timer
                    document.getElementById('timer').textContent = pad(minutesDisplay) + ":" + pad(secondsDisplay);

                    if (totalSeconds <= 0) {
                        clearInterval(countdownInterval);
                        document.getElementById('timer').textContent = '00:00';
                    }

                    totalSeconds -= 1;
                }, 1000);
            }

            function pad(val) {
                var valString = val + "";
                if (valString.length < 2) {
                    return "0" + valString;
                } else {
                    return valString;
                }
            }

            socket.on('word_guessed', function(data) {
                var result = data['result'];
                if (result === 'correct') {
                    alert('You guessed the word correctly!');
                } else {
                    alert('Incorrect guess. Try again!');
                }
            });

            socket.on('game_over', function(data) {
                alert(data['message']);
            });

            socket.on('redirect_home', function() {
                window.location.href = '/';
            });
        });
    </script>
</head>
<body>
    <h1>Room: {{ room_code }}</h1>
    <div id="timer" style="position: absolute; top: 10px; right: 10px; font-size: 20px;"></div>
    <div id="word" style="font-size: 20px; margin-top: 20px;"></div>
    <div id="chat" style="border: 1px solid black; height: 300px; overflow-y: scroll;"></div>
    <br>
    <input type="text" id="message" placeholder="Type your message">
    <button id="send">Send</button>
    <br><br>
    <a href="/">Back to Home</a>
</body>
</html>
