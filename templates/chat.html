<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <link rel="stylesheet" type="text/css" href="../Styles/chat.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var socket = io();
            var room = "{{ room_code }}";
            var username = "{{ username }}";
            var countdownInterval;

            socket.emit('join', {'username': username, 'room': room});

            document.getElementById('send').onclick = function() {
                var message = document.getElementById('message').value;
                var language = document.getElementById('language').value;
                socket.emit('message', {'username': username, 'message': message, 'room': room, 'language':language});
                document.getElementById('message').value = '';
            };

            document.getElementById('exit').onclick = function() {
                if (confirm("Are you sure you want to exit the room?")) {
                    socket.emit('leave', {'username': username, 'room': room});
                    window.location.href = '/'; // Redirect to home page
                }
            };

            socket.on('connect', function() {
                console.log('Connected with session ID:', socket.id);
            });

            socket.on('start_timer', function(data) {
                var countdownSeconds = data['countdown_seconds'];
                startCountdown(countdownSeconds);
            });

            socket.on('time_out', function() {
                alert('Time out!');
                window.location.href = '/';
            });

            socket.on('reveal_word', function(data) {
                var word = data['word'];
                document.getElementById('word').textContent = '' + word;
            });

            function startCountdown(totalSeconds) {
                var minutesDisplay, secondsDisplay;

                countdownInterval = setInterval(function() {
                    minutesDisplay = Math.floor(totalSeconds / 60);
                    secondsDisplay = totalSeconds % 60;

                    // Display the countdown timer
                    document.getElementById('timer').textContent = pad(minutesDisplay) + ":" + pad(secondsDisplay);

                    if (totalSeconds <= 0) {
                        clearInterval(countdownInterval);
                        document.getElementById('timer').textContent = '00:00';
                    }

                    totalSeconds -= 1;
                }, 1000);
            }

            function pad(val) {
                var valString = val + "";
                if (valString.length < 2) {
                    return "0" + valString;
                } else {
                    return valString;
                }
            }

            socket.on('word_guessed', function(data) {
                var result = data['result'];
                if (result === 'correct') {
                    alert('You guessed the word correctly!');
                } else {
                    alert('Incorrect guess. Try again!');
                }
            });

            socket.on('game_over', function(data) {
                alert(data['message']);
                setTimeout(function() {
                    window.location.href = '/';
                }, 3000); // Wait 3 seconds before redirecting
            });

            socket.on('redirect_home', function() {
                window.location.href = '/';
            });

            socket.on('player_left', function() {
                alert('The other player left the game. The game is over. Nobody won.');
                window.location.href = '/';
            });
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
        }
        #left-half, #right-half {
            width: 50%;
            padding: 10px;
            box-sizing: border-box;
        }
        #left-half {
            border-right: 1px solid #ccc;
            position: relative; /* Ensure the timer and word display are positioned correctly */
        }
        #code-container {
            padding: 10px;
            border: 1px solid black;
        }
        #message {
            width: 100%;
            height: 100px;
            font-family: monospace;
            resize: none;
            padding: 10px;
            box-sizing: border-box;
        }
        #send, #exit {
            margin-top: 10px;
        }
        #word {
            font-size: 20px;
            padding: 20px; /* Adjust padding to center vertically and horizontally */
            margin: 20px 0; /* Adjust margin for spacing */
            border: 1px solid black; /* Optional: Add border to contain the question nicely */
        }
    </style>
</head>
<body>
    <div id="left-half">
        <h1>Room: {{ room_code }}</h1>
        <div id="timer" style="position: absolute; top: 10px; right: 10px; font-size: 20px;"></div>
        <div id="word">Question:</div> <!-- Remove inline style -->
        <div id="chat" style="border: 1px solid black; height: 300px; overflow-y: scroll;"></div>
    </div>
    <div id="right-half">
        <div id="code-container">
            <select id="language">
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="java">Java</option>
                <option value="c++">C++</option>
                <option value="ruby">Ruby</option>
                <option value="go">Go</option>
            </select>
            <textarea id="message" placeholder="Type your message or code"></textarea>
            <button id="send">Send</button>
            <button id="exit">Exit Room</button>
        </div>
    </div>
    <a href="/" style="position: absolute; bottom: 10px; left: 10px;">Back to Home</a>
</body>
</html>
